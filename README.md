# Мобильное приложение "Список любимых фильмов" для ОС Аврора

## ЗАДАНИЕ
Разработать мобильное приложение для ОС Аврора "Список любимых фильмов".
- Отображать список сохранённых фильмов.
- Для каждого фильма можно указать фотографию постера и написать текстовое описание.
- Фильмы сохраняются в ПЗУ телефона. После перезагрузки телефона сохранённые фильмы должны отображаться.
- Приложение должно проходить валидацию. Приложение должно работать без интернета.

## ВВЕДЕНИЕ
Данный проект представляет собой мобильное приложение для ОС Аврора, позволяющее пользователям создавать и управлять личной коллекцией любимых фильмов. В приложении реализован полный цикл CRUD-операций (создание, чтение, обновление, удаление) для информации о фильмах, включая возможность добавления постеров.

### Реферат
Приложение "Список любимых фильмов" разработано для операционной системы Аврора с использованием технологий Qt/QML/C++. Основная цель приложения — предоставить удобный интерфейс для ведения каталога любимых фильмов пользователя с возможностью сохранения данных в постоянной памяти устройства. Приложение полностью работает в офлайн-режиме и следует стандартам и рекомендациям по разработке для ОС Аврора.

## ГЛАВА 1. Теоретические основы и постановка задачи

### 1.1 Описание предметной области
Мобильные приложения для каталогизации развлекательного контента стали важной частью повседневной жизни. Приложения для отслеживания фильмов, сериалов, книг и другого медиа-контента позволяют пользователям организовывать свои коллекции, отмечать любимые произведения и делиться рекомендациями.

В контексте отечественной мобильной ОС Аврора особенно актуально создание нативных приложений, обеспечивающих функциональность, аналогичную популярным сервисам, но работающих полностью в автономном режиме без необходимости подключения к интернету.

### 1.2 Постановка задачи проекта
Основная задача проекта — разработать мобильное приложение для ОС Аврора, которое позволит:
- Просматривать список добавленных фильмов
- Добавлять новые фильмы с указанием названия
- Для каждого фильма просматривать и редактировать детальную информацию:
  - Постер (изображение)
  - Описание
  - Год выпуска
  - Страна производства
  - Жанр
- Сохранять данные о фильмах в постоянной памяти устройства
- Удалять фильмы из списка

Приложение должно работать в офлайн-режиме и соответствовать гайдлайнам ОС Аврора для успешной валидации.

### 1.3 Используемые технологии
Для разработки приложения использованы следующие технологии:
- **QML**: Декларативный язык для создания пользовательского интерфейса
  - QtQuick 2.0: Основные компоненты для создания интерфейса
  - Sailfish.Silica 1.0: Библиотека компонентов для ОС Аврора
- **C++**: Язык разработки бизнес-логики приложения
  - Qt Core: Основные классы для работы с данными
  - Qt JSON: Классы для обработки данных в формате JSON
- **JSON**: Формат для хранения данных приложения

### 1.4 Особенности разработки для ОС Аврора
ОС Аврора имеет ряд особенностей, которые необходимо учитывать при разработке приложений:
- Использование компонентов Sailfish.Silica вместо стандартных компонентов QtQuick.Controls
- Адаптация интерфейса под жесты и особенности навигации в Авроре
- Необходимость соответствия гайдлайнам и рекомендациям по дизайну интерфейса
- Особенности работы с постоянным хранилищем данных
- Отсутствие зависимостей от сетевых сервисов для офлайн-работы

## ГЛАВА 2. Архитектура и реализация приложения

### 2.1 Архитектурные решения
Архитектура приложения основана на паттерне Model-View-Controller (MVC):
- **Model**: Класс MovieManager (C++), отвечающий за хранение и управление данными о фильмах
- **View**: QML-компоненты для отображения интерфейса (MainPage.qml, MovieDetailPage.qml и др.)
- **Controller**: Связующее звено между Model и View через контекстные свойства QML

Структура проекта организована следующим образом:
- `src/` - исходные коды C++ (MovieManager)
- `qml/` - QML-файлы для интерфейса
  - `pages/` - основные страницы приложения
  - `dialogs/` - диалоговые окна
  - `cover/` - обложка приложения
- `images/` - ресурсы изображений
- `translations/` - файлы для локализации

### 2.2 Реализация логики на языке C++
Основная бизнес-логика приложения реализована в классе `MovieManager`:

```cpp
class MovieManager : public QObject
{
    Q_OBJECT

public:
    explicit MovieManager(QObject *parent = nullptr);
    ~MovieManager();

    Q_INVOKABLE void loadMovies();
    Q_INVOKABLE void saveMovies();
    Q_INVOKABLE void addMovie(const QString &title);
    Q_INVOKABLE void updateMovie(const QString &id, const QVariantMap &movieData);
    Q_INVOKABLE void deleteMovie(const QString &id);
    Q_INVOKABLE QVariantList getMovies();
    Q_INVOKABLE QVariantMap getMovieById(const QString &id);

signals:
    void moviesChanged();

private:
    QString generateUniqueId();
    QString getMoviesFilePath();
    QList<QVariantMap> m_movies;
};
```

Класс обеспечивает:
- Загрузку и сохранение данных о фильмах в JSON-файл
- CRUD-операции над фильмами (создание, чтение, обновление, удаление)
- Сигнал moviesChanged() для оповещения QML о изменениях в данных
- Генерацию уникальных идентификаторов для фильмов

Для хранения данных используется формат JSON, который обеспечивает простоту и переносимость данных. Каждый фильм представлен как объект с полями id, title, posterPath, description, year, country, genre.

### 2.3 Реализация пользовательского интерфейса на QML

#### 2.3.1 Общая структура приложения
Пользовательский интерфейс приложения состоит из следующих основных компонентов:
- `study.qml` - главное окно приложения
- `MainPage.qml` - главная страница со списком фильмов
- `MovieDetailPage.qml` - страница для просмотра и редактирования деталей фильма
- `AddMovieDialog.qml` - диалог для добавления нового фильма
- `DefaultCoverPage.qml` - обложка приложения для режима ожидания

#### 2.3.2 Основные элементы интерфейса и их назначение
**MainPage.qml** - отображает список фильмов:
- `SilicaListView` с моделью фильмов
- `PullDownMenu` с опцией обновления списка
- Кнопка добавления нового фильма
- При нажатии на элемент списка открывается страница деталей фильма

**MovieDetailPage.qml** - страница с деталями фильма:
- Отображение постера фильма (если указан)
- Поля для редактирования информации о фильме:
  - Название
  - Год выпуска (с валидацией на числовые значения)
  - Страна производства
  - Жанр
  - Описание
  - Путь к изображению постера
- Кнопки для сохранения изменений и удаления фильма

**AddMovieDialog.qml** - диалог для добавления нового фильма:
- Поле для ввода названия фильма
- Кнопки подтверждения и отмены

**DefaultCoverPage.qml** - обложка приложения:
- Отображение названия приложения
- Информация о количестве фильмов в коллекции

### 2.4 Интеграция C++ и QML
Интеграция C++ и QML осуществляется через контекстные свойства QML. В `main.cpp` создается экземпляр класса `MovieManager` и регистрируется как контекстное свойство:

```cpp
int main(int argc, char *argv[])
{
    QScopedPointer<QGuiApplication> application(Aurora::Application::application(argc, argv));
    application->setOrganizationName(QStringLiteral("ru.template"));
    application->setApplicationName(QStringLiteral("study"));

    // Create and register the MovieManager
    QScopedPointer<MovieManager> movieManager(new MovieManager());

    QScopedPointer<QQuickView> view(Aurora::Application::createView());
    
    // Set the MovieManager as a context property
    view->rootContext()->setContextProperty("movieManager", movieManager.data());
    
    view->setSource(Aurora::Application::pathTo(QStringLiteral("qml/study.qml")));
    view->show();

    return application->exec();
}
```

В QML-коде экземпляр `movieManager` доступен напрямую и используется для вызова методов и получения данных:

```qml
// Пример загрузки списка фильмов
function loadMoviesToModel() {
    movieListModel.clear()
    var movies = movieManager.getMovies()
    for (var i = 0; i < movies.length; i++) {
        movieListModel.append({
            "id": movies[i].id,
            "title": movies[i].title
        })
    }
}

// Пример подписки на изменения данных
Connections {
    target: movieManager
    onMoviesChanged: {
        loadMoviesToModel()
    }
}
```

### 2.5 Стилизация и локализация
Приложение использует стилевые компоненты из библиотеки Sailfish.Silica, что обеспечивает соответствие внешнего вида приложения общему стилю ОС Аврора:
- Использование Theme.* для цветов, размеров шрифтов и отступов
- Применение стандартных компонентов: Page, PageHeader, Button, ListView, ListItem, SilicaFlickable, Dialog, TextField, TextArea

Для локализации используется функция qsTr() для всех текстовых строк в интерфейсе, что позволяет в будущем добавить поддержку других языков через файлы переводов.

## ГЛАВА 3. Результаты и выводы по итогам работы

### 3.1 Достигнутые результаты
В результате выполнения проекта было разработано полнофункциональное мобильное приложение "Список любимых фильмов" для ОС Аврора, которое отвечает всем заявленным требованиям:
- Реализован просмотр списка фильмов
- Добавлена возможность создания, редактирования и удаления фильмов
- Обеспечено хранение данных в постоянной памяти устройства
- Реализована поддержка постеров для фильмов
- Приложение полностью работает в офлайн-режиме
- Интерфейс соответствует гайдлайнам ОС Аврора

### 3.2 Анализ хода работы и полученный опыт
В процессе разработки были получены ценные навыки:
- Разработка нативных приложений для ОС Аврора
- Использование связки QML + C++ для создания мобильных приложений
- Работа с постоянным хранилищем на мобильных устройствах
- Создание интерфейса с учетом особенностей мобильных платформ

### 3.3 Возникшие трудности и пути их решения
В процессе разработки были выявлены и решены следующие трудности:
1. **Проблема с отображением изображений**: 
   - Проблема заключалась в использовании неправильных путей к ресурсам
   - Решение: реализация функции resolveImagePath для корректного формирования путей к ресурсам в зависимости от типа пути

2. **Сохранение данных при перезагрузке устройства**:
   - Необходимо было гарантировать, что данные будут сохраняться в постоянной памяти
   - Решение: усиление механизма сохранения через добавление точек сохранения при сворачивании приложения и принудительную запись на диск

3. **Валидация ввода для года выпуска**:
   - Требовалось ограничить ввод только числовыми значениями
   - Решение: использование IntValidator и дополнительной проверки через регулярные выражения

4. **Совместимость с JavaScript в QML**:
   - Проблема с методами строк, которые не поддерживаются в версии JavaScript в Авроре
   - Решение: использование более совместимых методов (indexOf вместо includes, startsWith)

### 3.4 Перспективы развития проекта
Проект имеет потенциал для дальнейшего развития:
1. **Расширение функциональности**:
   - Добавление рейтингов и оценок для фильмов
   - Реализация фильтрации и поиска по списку фильмов
   - Группировка фильмов по категориям/жанрам

2. **Улучшение пользовательского опыта**:
   - Добавление предзагрузки постеров при прокрутке списка
   - Реализация выбора постера из галереи устройства
   - Добавление анимаций для плавных переходов между экранами

3. **Расширение возможностей хранения данных**:
   - Реализация экспорта/импорта коллекции фильмов
   - Добавление возможности резервного копирования

## СПИСОК ЛИТЕРАТУРЫ
1. Официальная документация ОС Аврора [Электронный ресурс]. – Режим доступа: https://docs.auroraos.ru/
2. Qt Documentation [Электронный ресурс]. – Режим доступа: https://doc.qt.io/
3. Шлее М. Qt 5.10. Профессиональное программирование на C++. – СПб.: БХВ-Петербург, 2018. – 1072 с.
4. Вадим Половников. QML - язык для мобильных приложений на Qt // Системный администратор. 2019. № 3.
5. Blanchette J., Summerfield M. C++ GUI Programming with Qt 4. – Prentice Hall, 2008.

## Приложение
### Исходный код ключевых компонентов приложения

**MovieManager.h**:
```cpp
#ifndef MOVIEMANAGER_H
#define MOVIEMANAGER_H

#include <QObject>
#include <QVariantList>
#include <QVariantMap>
#include <QList>
#include <QString>

class MovieManager : public QObject
{
    Q_OBJECT

public:
    explicit MovieManager(QObject *parent = nullptr);
    ~MovieManager();

    Q_INVOKABLE void loadMovies();
    Q_INVOKABLE void saveMovies();
    Q_INVOKABLE void addMovie(const QString &title);
    Q_INVOKABLE void updateMovie(const QString &id, const QVariantMap &movieData);
    Q_INVOKABLE void deleteMovie(const QString &id);
    Q_INVOKABLE QVariantList getMovies();
    Q_INVOKABLE QVariantMap getMovieById(const QString &id);

signals:
    void moviesChanged();

private:
    QString generateUniqueId();
    QString getMoviesFilePath();
    QList<QVariantMap> m_movies;
};

#endif // MOVIEMANAGER_H
```

**Модель данных фильма**:
Каждый фильм содержит следующие атрибуты:
- id: string (уникальный идентификатор)
- title: string (название фильма)
- posterPath: string (путь к изображению постера)
- description: string (текстовое описание)
- year: string (год выпуска)
- country: string (страна производства)
- genre: string (жанр фильма) 